% CÓDIGO DE MATLAB PARA REALIZAR EL DESPLIEGUE DE LA GRÁFICA DEL GAS NATURAL. 

% AQUÍ SE GUARDA EL ID DE CANAL EN UNA VARIABLE.
readChannelID = [1486425];
% SE DECLARAN LOS 3 CANALES EN TRES VARIABLES DIFERENTES.
fieldID1 = 1;
fieldID2 = 2;
fieldID3 = 3;

% SE GUARDA LA CORRESPONDIENTE LLAVE DE API DE LECTURA EN UNA VARIABLE.
readAPIKey = 'SVVLAKXW4F98CJJ1';

%% LECTURA DE DATOS CON ESTAMPA DE TIEMPO Y FECHA CON LECTURA DE 25 DE DATOS.%%
[data, time] = thingSpeakRead(readChannelID, 'Field', fieldID2, 'NumPoints', 2, 'ReadKey', readAPIKey);
% AQUÍ SE REALIZA LA ANALÍTICA DE TAL MANERA QUE CUANDO SE RECIBAN MAS DE 2 DATOS
% TAL QUE SEAN MAYORES A 10 PPM, ENVÍA UN VALOR '1' AL CANAL DE ACCION
% DE GAS NATURAL DEL CANAL DEL ATOMIZADOR, DE TAL FORMA QUE LA RASPBERRY LEE 
% DICHO CANAL Y EJECUTA DE MANERA PRIORITARIA EL ATOMIZADOR.

% EL SEGUNDO IF, CORRESPONDE A QUE CUANDO EL CONTEO ES MAYOR A 1 Y YA SE
% LLEGARON LA MAYORIA DE DATOS, REINICIA EL CONTEO Y ENVIA UN '1' AL CANAL DEL 
% ATOMIZADOR DEL GAS NATURAL TAL QUE LA RASPBERRY LEE EL DATO Y EJECUTA EL ATOMIZADOR CADA 
% 7 SEGUNDOS. 

% ESTE CAMPO VUELVE A 0 CUANDO YA SE HAYA ACTIVADO UNA VEZ, Y EL DATO
% LO ENVIA LA RASPBERY.
count = 0;
for i=1:1:2
    if data(i)>10
        count = count + 1
    end
    if count > 1
        thingSpeakWrite(1577876,'Fields',1,'Values',1,'WriteKey','35GDXUSGH2W745QO');
        count = 0
        break
    end
end
%